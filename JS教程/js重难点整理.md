**理解作用域链**

**执行环境**（execution context）是 js 的一个重要概念。

每个执行环境都有一个**变量对象**，环境中定义的所有变量和函数都保存在这个变量中。

**全局执行环境**是最外围的一个执行环境。在浏览器中，全局执行环境是的**变量对象**是 window 对象，所有全局变量和函数都是作为 window 对象的属性和方法创建的。

每个**函数**都有自己的**执行环境**，当前执行环境是函数，则将其**活动对象**（activation object）作为它的**变量对象**。

当代码在一个环境中执行时，会创建一个由变量对象构成的**作用域链**（scope chain）。它的作用是保证对执行环境有权访问的所有变量和函数的有序访问。

作用域链的第一个变量对象，始终是当前执行代码所在环境的变量对象；作用域链的下一个对象，是来自包含环境的变量对象，一直到全局执行环境；作用域链的最后一个变量对象，始终是全局执行环境中的变量对象，在浏览器中，就是 window 对象。作用域链的本质是一个指向变量对象的指针列表。

全局执行环境中的变量对象始终存在，而函数的变量对象，只在函数执行过程中存在。

**标识符的解析**（即变量名的查找），是根据作用域链一级一级地向后搜索的过程。无论什么时候在函数中访问一个变量时，就会从作用域链中一级一级搜索变量。

一般来讲，当函数执行完毕后，局部活动对象就会被销毁，内存中仅保存全局作用域。但闭包的情况有所不同。

**理解闭包**

*闭包是指有权访问另一个函数作用域中的变量的函数。创建闭包的常见方式是在一个函数内部创建另一个函数。*

(当某个函数被调用时，会创建一个执行环境及相应的作用域链。)

在一个函数内部定义的函数会将外部函数的活动对象添加到它的作用域链中。外部函数的执行环境的作用域链会被销毁，但它的活动对象仍会留在内存中，直到内部函数被销毁。

由于闭包会携带它的外部函数的作用域，因此会比其他函数占用更多的内存，过度使用闭包可能会导致内存占用过多，建议只在绝对必要时再考虑使用闭包。

