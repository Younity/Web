自动类型转换
============

*《JavaScript 教程》作者：阮一峰*

1 概述
------

JS 中各种运算符对数据类型是有要求的。如果运算符发现，运算子的类型与预期不符，就会自动转换类型。

比如，减法运算符预期左右两侧的运算子应该是数值，如果不是，就会自动将它们转为数值。

2 强制类型转换
-------------

强制转换主要指使用Number()、String()和Boolean()三个函数，手动将各种类型的值，分别转换成数字、字符串或者布尔值。

**Number() 函数，可以将任意类型的值转化成数值**

1. 参数是原始类型的值

   ```JS
    // 数值：转换后还是原来的值
    Number(324) // 324

    // 字符串：如果可以被解析为数值，则转换为相应的数值
    Number('324') // 324

    // 字符串：如果不可以被解析为数值，返回 NaN
    Number('324abc') // NaN

    // 空字符串转为0
    Number('') // 0

    // 布尔值：true 转成 1，false 转成 0
    Number(true) // 1
    Number(false) // 0

    // undefined：转成 NaN
    Number(undefined) // NaN

    // null：转成0
    Number(null) // 0

    // 过滤前导和后缀空格
    Number('\t\v\r12.34\n') // 12.34
    ```

    注意：Number函数将字符串，只要有一个字符无法转成数值，整个字符串就会被转为NaN。Number函数会自动过滤一个字符串前导和后缀的空格。

2. 参数是对象

    简单的规则是，Number方法的参数是对象时，将返回NaN，除非是包含单个数值的数组。

    Number 方法背后的转换规则：

    第一步，调用对象自身的valueOf方法。如果返回原始类型的值，则直接对该值使用Number函数，不再进行后续步骤。

    第二步，如果valueOf方法返回的还是对象，则改为调用对象自身的toString方法。如果toString方法返回原始类型的值，则对该值使用Number函数，不再进行后续步骤。

    第三步，如果toString方法返回的是对象，就报错。

**String() 函数可以将任意类型的值转化成字符串**

1. 参数是原始类型的值

    ```JS
    String(123) // "123"
    String('abc') // "abc"
    String(true) // "true"
    String(undefined) // "undefined"
    String(null) // "null"
    ```

2. 参数是对象

    String方法的参数如果是对象，返回一个类型字符串；如果是数组，返回该数组的字符串形式。

    String方法背后的转换规则，与Number方法基本相同，只是互换了valueOf方法和toString方法的执行顺序

    第一步，先调用对象自身的toString方法。如果返回原始类型的值，则对该值使用String函数，不再进行以下步骤。

    第二步，如果toString方法返回的是对象，再调用原对象的valueOf方法。如果valueOf方法返回原始类型的值，则对该值使用String函数，不再进行以下步骤。

    第三步，如果valueOf方法返回的是对象，就报错。

**Boolean() 函数可以将任意类型的值转为布尔值**

除了以下五个值的转换结果为false，其他的值全部为true。

```JS
Boolean(undefined) // false
Boolean(null) // false
Boolean(0) // false
Boolean(NaN) // false
Boolean('') // false

Boolean(true) // true
Boolean(false) // false
```

注意，所有对象（包括空对象）的转换结果都是true，甚至连false对应的布尔对象new Boolean(false)也是true.

3 自动类型转换
------------

自动转换，它是以强制转换为基础的。

遇到以下三种情况时，JavaScript 会自动转换数据类型，即转换是自动完成的，用户不可见。

第一种情况，不同类型的数据互相运算。

第二种情况，对非布尔值类型的数据求布尔值。

第三种情况，对非数值类型的值使用一元运算符（即+和-）。

**自动转换的规则**是这样的：预期什么类型的值，就调用该类型的转换函数。

由于自动转换具有不确定性，而且不易除错，**建议**在预期为布尔值、数值、字符串的地方，全部使用Boolean、Number和String函数进行显式转换。

**自动转换为布尔值**

JavaScript 遇到预期为布尔值的地方（比如if语句的条件部分），系统内部会自动调用Boolean函数，将非布尔值的参数自动转换为布尔值。

**自动转换为字符串**

JavaScript 遇到预期为字符串的地方，系统内部会自动调用String函数，将非字符串的值自动转为字符串。

字符串的自动转换，主要发生在字符串的加法运算时。当一个值为字符串，另一个值为非字符串，则后者转为字符串。

**自动转换为数值**

JavaScript 遇到预期为数值的地方，系统内部会自动调用Number函数，将参数值自动转换为数值。

除了加法运算符（+）有可能把运算子转为字符串，其他运算符都会把运算子自动转成数值。